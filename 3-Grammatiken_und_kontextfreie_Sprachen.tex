\section{Grammatiken und kontextfreie Sprachen}
\datenote{18.11.16}
Im folgenden Kapitel wechseln wir den Standpunkt von Spracherkennung auf \emph{Spracherzeugung}.
Das Werkzeug sind hierbei sogenannte \emph{Phasenstrukturgrammatiken}, oder kurz, \emph{Grammatiken}.
Bei Grammatiken gibt es neben dem Alphabet weitere Symbole, sogenannte \emph{Nichtterminale} oder \emph{Variablen}, und ein Regelsystem mit dem Worte, die Nichtterminale enthalten, geändert werden können.
\begin{Def}[Chomsky]
	Eine \emph{Grammatik} ist ein 4-Tupel $(N,\Sigma,P,S)$
	\begin{itemize}
	\item $N$ ist eine endliche Menge von \emph{Nichtterminalsymbolen}.
	\item $\Sigma$ ist ein Alphabet von \emph{Terminalsymbolen} (Variablen).
	\item $P\subset (N\cup\Sigma)^*N(N\cup\Sigma)^* \x (N\cup\Sigma)^*$ ist endliche Menge von Regeln, sogenannte \emph{Produktionen}.
	\item $S\in N$ ist das \emph{Startsymbol}.
	\end{itemize}
\end{Def}
\begin{Bsp}
  $\mathcal{G} = (N, \Sigma, P, E)$ mit
	\begin{align*}
		\Sigma &= \{ \mathtt{a},\mathtt{(},\mathtt{)},\mathtt{*},\mathtt{+} \}\\
		N &= \{E\}\\
		P &= \begin{aligned}[t]
      \{ E &\-> a,\\
      E &\-> (E*E),\\
      E &\-> (E+E) \}
        \end{aligned}
	\end{align*}
\end{Bsp}
  $G$ erzeugt geklammerte arithmetische Ausdrücke über der Konstante $\mathtt{a}$, wie zum Beispiel das Wort $\mathtt{(a*(a+a))}$.
  Eine Grammatik erzeugt Worte durch \emph{Ableitungen}, die wir im Folgenden definieren.
\begin{Def}[Ableitungsrelation, Ableitung, Sprache einer Grammatik][name={[Ableitungsrelation]}]
  Sei $\mathcal{G} =(N,\Sigma,P,S)$ eine Grammatik.

	Die \emph{Ableitungsrelation} zu $\mathcal{G}$ ist 
  \begin{displaymath}
    \cdot \==>_\mathcal{G} \cdot \subseteq (N\cup\Sigma)^*\x(N\cup\Sigma)^*
  \end{displaymath}
  mit $\alpha \==>_\mathcal{G} \beta$ gdw 
  \begin{itemize}
  \item $\alpha = \gamma_1\alpha'\gamma_2$,
  \item $\beta = \gamma_1\beta'\gamma_2$ und
  \item $\alpha' \to \beta' \in P$
  \end{itemize}

  Eine Folge $\alpha = \alpha_0,\ldots,\alpha_n = \beta$ heißt \emph{Ableitung von $\beta$ aus $\alpha$ in $n$ Schritten}, geschrieben $\alpha \stackrel{n}{\==>}_\mathcal{G} \beta$, gdw $\alpha_i \==>_\mathcal{G} \alpha_{i+1}$ für $0 \le i < n$.
  Jedes solche $\alpha_i$ heißt \emph{Satzform von $\mathcal{G}$}.

  Die \emph{Ableitung von $\beta$ aus $\alpha$}, geschrieben $\alpha \stackrel{*}{\==>}_\mathcal{G} \beta$, existiert gdw ein $n \in \N$ existiert, so dass $\alpha \stackrel{n}{\==>}_\mathcal{G} \beta$.
  Damit ist ,,$\stackrel{*}{\==>}_\mathcal{G}$'' die reflexive, transitive Hülle von ,,$\==>_\mathcal{G}$''.

	Die \emph{Sprache, die von $\mathcal{G}$ erzeugt wird} ist definiert als:
	\[ L(\mathcal{G}) = \{w\in\Sigma^* \mid S \stackrel{*}{\==>}_{\mathcal{G}} w \}\]
	
\end{Def}

\draftnote{18.11.16}

\begin{Bsp}
  \begin{align*}
		E &\=> a\\
		E &\=> (E*E) \=> (a*E)\\
		&\=> (a*(E+E)) \=> \dots \=> (a*(a+a))
  \end{align*}
\end{Bsp}

\begin{Bsp} $\mathcal{G}=(N,\Sigma,P,S)$ mit
	\begin{align*}
		N &= \{S,B,C\}\\
		\Sigma &= \{a,b,c\}\\8
		P &= 
		\begin{aligned}[t]
			 \{ &S \-> aSBC,\ S\->aBC,\ CB\-> BC,\ aB\-> ab,\\
			 &bB\-> bb, bC\-> bc, cC\-> cc \} & \quad\text{Startsymbol }S
		\end{aligned}\\
		L(\mathcal{G}) &=  \{ a^nb^nc^n \mid n\geq 1 \}\\
		S &\=> aBC \=> abC \=> abc \qquad S\=>a\emph{S}BC \=> aa\emph{S}BCBC\\
		S &\=> aSBC \xRightarrow{n-2} n \=> a^{n-1}S(BC)^{n-1} \=> a^n(BC)^n = a^nBCBC \dots \=> a^nBBCCBC\\
		&\=> a^nB^nC^n \xRightarrow* a^nb^nc^n
	\end{align*}
\end{Bsp}
Die Chomsky-Hierarchie teilt die Grammatiken in vier Typen unterschiedlicher Mächtigkeit ein.
\begin{Def}[Chomsky Hierarchie]\
	\begin{itemize}
	\item Jede Grammatik ist eine \emph{Typ-0 Grammatik}.
	\item Eine Grammatik ist \emph{Typ-1} oder \emph{kontextsensitiv}, falls alle Regeln expansiv sind, d.h. $\alpha\->\beta\in P$, dann ist $|\alpha|\leq |\beta|$ mit einer Ausnahme: falls $S$ nicht in einer rechten Regelseite auftritt, dann ist $S\->\Eps$ erlaubt.
	\item Eine Grammatik heißt \emph{Typ-2} oder \emph{kontextfrei}, falls alle Regeln die Form $A\->\alpha$ mit $A\in N$ und $\alpha\in(N\cup\Sigma)^*$ haben.
	\item Eine Grammatik heißt \emph{Typ-3} oder \emph{regulär}, falls alle Regeln die Form
	\begin{alignat*}{2}
		\text{Form}\quad &A\->w &\quad w&\in\Sigma^*\\
		\text{oder}\quad &A\->aB& a&\in\Sigma,\ B\in N
	\end{alignat*}
	\end{itemize}
	Eine Sprache heißt Typ-$i$ Sprache, falls $\exists$ Typ-$i$ Grammatik für sie.
\end{Def}

\begin{Beobachtung}
	Jede Typ $i+1$ Sprache ist nicht Typ-$i$ Sprache.
\end{Beobachtung}
Jede Typ-3 Grammatik ist Typ-2 Grammatik.\\
Jede Typ-2 Grammatik kann in äquivalente $\Eps$-freie Typ-2 Grammatik transformiert werden. \-> Typ-1 Grammatik. (Vgl.\ Elmination von $\Eps$-Produktionen)

Ziel: Hierarchie-Satz (Chomsky)\\
Sei $\mathcal{L}_i$ die Menge der Typ-$i$ Sprachen.\\
Es gilt $\mathcal{L}_3 \subsetneq \mathcal{L}_2 \subsetneq\mathcal{L}_1 \subsetneq\mathcal{L}_0$

\draftnote{25.11.16}
\begin{Satz}[name={[Typ-3 Sprache ist regulär]}]
	$L$ ist regulär \<=> $L$ ist Type-3 Sprache
\end{Satz}
\begin{proof}
	\begin{description}[font=\normalfont,labelwidth=\widthof{"'\=>"':},leftmargin=!]
	\item["`\=>"'] Sei $\A =(Q,\Sigma,\delta,q_0,F)$ \ac{DFA} für $L$.\\
		Konstruiere Grammatik $\mathcal{G}=(N,\Sigma,P,S)$
		\begin{alignat*}{2}
			N &=Q &\qquad S&=q_0\\
			q&\in Q\ \mathrlap{\forall a: \delta(q,a)=q'\ \curvearrowright\ q\->aq'\in P}\\
			q&\in F & q&\->\Eps\in P
		\end{alignat*}
		Zeige noch $L(\mathcal{G})=L(\A)$
	\item["`\<="'] Sei $\mathcal{G}=(N,\Sigma,P,S)$ Typ-3 Grammatik
	Def. $\A=(Q,\Sigma,\delta,q_0,F)$ \ac{NFA}
	\begin{alignat*}{2}
		Q &=N\cup\dots\\
		q_0 &=S\\
		A &\->aB\in P & \delta(A,a)&\ni B\\
		A &\->a,\dots a_n &\qquad n=0\=>A &\in F\\
		&\mathclap{\tikz[shorten >=1pt,on grid,node distance=1.5cm, every state/.style={minimum size=0pt,inner sep=0pt}]{
			\node[state,inner sep=3pt] (q0) {$A$};
			\node [above=0pt of q0.north] {$n>0$: $n$ weitere Zust"ande erforderlich, letzter Endzustand};
			\node[state] (q1) [right=of q0] {};
			\node (dots) [right=of q1] {\dots};
			\node[state,accepting] (qa) [right=of dots] {};
			\path[-stealth] (q0) edge node[auto] {$a_1$} (q1)
				(q1)   edge node[auto] {$a_2$} (dots)
				(dots) edge node[auto] {$a_n$} (qa);
		}}\\
		\text{Zeige noch }\quad
		L(\mathcal{G})&=L(\A) \tag*{\qedhere}
	\end{alignat*}
	\end{description}
\end{proof}


\begin{lemma}
	$\mathcal{L}_3 \subsetneq \mathcal{L}_2$
\end{lemma}
\begin{proof}
	Betrachte $L=\{a^nb^n \mid n\in\N \}$\\
	bekannt: $L$ nicht regulär.\\
	Aber $\exists$ Typ-2 Grammatik für $L$:
	\[ \mathcal{G} = (\{S\}, \{a,b\}, \{S\->\Eps, S\->aSb \}, S) \]
	Zeige (selbst) $L=L(\mathcal{G})$
\end{proof}

\datenote{30.11.16}
\subsection{Kontextfreie Sprachen}
Hier sind einige Beispiele kontextfreier Sprachen und Grammatiken:
\begin{itemize}
\item Arithmetische Ausdrücke: $(\{E\}, \{a, \mathnormal{+}, \mathnormal{*}, \mathnormal{(}, \mathnormal{)}\}, P, E)$ mit
  \begin{displaymath}
    P =
    \begin{aligned}[t]
      \{ E &\->a, \\
        E &\->(E+E), \\
        E &\->(E*E) \}
    \end{aligned}
  \end{displaymath}
\item Syntax von Programmiersprachen%\\[\abovedisplayskip]
	\begin{center}
		\begin{tabular}[t]{r@{ }l}
			<Stmt> &\-> <Var> = <Exp>\\
			&| <Stmt>\,;\,<Stmt>\\
			&| if\,(<Exp>) <Stmt>\\
			&\phantom{|} else <Stmt>\\
			&| while\,(<Exp>) <Stmt>
		\end{tabular}
	\end{center}%\\[\belowdisplayskip]
	Hier: Nichtterminal$\hat=$ Wort in spitzen Klammern <Stmt>;
	Terminalsymbol --- alles andere.
\item Palindrome über $\{a,b\}$
	\[ S\-> aSa \mid bSb \mid a \mid b \mid \Eps \]
\item Sprache der Worte über $\{0,1\}^*$, die gleich viele Nullen wie Einsen haben:
  \begin{displaymath}
    L = \{ w \in \Sigma^* \mid \#_0(w) = \#_1(w)\}
  \end{displaymath}
  Die Funktion $\#_a(w)$ berechnet hierbei die Anzahl der Vorkommen von $a \in \{0, 1\}$ in $w$.
  Eine Grammatik für $L$ ist $\mathcal{G} = (\{S\}, \{0,1\}, P, S)$ mit
  \begin{displaymath}
    P =
    \begin{aligned}[t]
      \{ S & \to 1S0S \\
        S & \to 0S1S \\
        S & \to \Eps
      \}
    \end{aligned}
  \end{displaymath}

  Das $L(\mathcal{G}) \subseteq L$ lässt sich per Induktion über die Länge der Ableitung von $S \stackrel{*}{\==>}_\mathcal{G} w$ zeigen.
  Der Beweis wird als Übung dem Leser überlassen.

  Wir zeigen das $L \subseteq L(\mathcal{G})$, also dass wenn $w \in L$, dann $w \in L(\mathcal{G})$ per Induktion über die Länge von $w$.
  Hierzu definieren wir die noch die Hilfsfunktion $d : \Sigma^* \to \N$ als
  \begin{align*}
    d(\Eps) &= 0 \\
    d(1w) &= d(w) + 1 \\
    d(0w) &= d(w) - 1
  \end{align*}
  Per Induktion über $w \in \Sigma^*$ lässt sich zeigen, dass $L = \{w \in \Sigma^* \mid d(w) = 0\}$ und $d(v \cdot w) = d(v) + d(w)$.
\begin{description}
\item[IA] $|w| = n = 0$, $w = \Eps$. Es gilt $\Eps \in L$, da $\#_0(\Eps) = \#_1(\Eps) = 0$.
\item[IV] $\forall n' < n: \forall w' \in \Sigma^*: falls |w| = n' \text{ und } w \in L \text{ dann } w \in L(\mathcal{G})$
\item[IS] $|w| = n > 1$, $w = aw'$, $a \in \{0,1\}$.

  Betrachte $a = 0$ (der Fall für $a = 1$ funktioniert analog).

  Da $d(w) = d(0w') = d(w') - 1 = 0$ ist $d(w') = 1$.

  Es stellt sich heraus, dass $w' = w_11w_2$, $d(w_1) = 0$ und $d(w_2) = 0$.
  \begin{itemize}
  \item[] 
    Sei $w' = a_1 \ldots a_n$.
    Betrachte die Folge $d_0,\ldots,d_n$ mit $d_0 = 0$ und $d_i = d(a_1\ldots a_i)$ für $1 \le i < n$.
    Wähle $0 \le i < n$ maximal, so dass für alle $0 \le j \le i$: $d_j < 1$.

    Da $i$ maximal ist folgt $d_{i+1} \ge 1$ und da $d_{i+1} - d_i \le 1$  folgt $d_i = 0$, $d_{i+1} = 1$ und $a_i = 1$.
    Setze also $w_1 = a_1\ldots a_{i}$.

    Es gilt also $w' = a_1\ldots a_{i}a_{i+1}w_2 = w_1w_2$ mit $d(w_1) = 0$.

    Da $d(v \cdot w) = d(v) + d(w)$ und $d(w') = d(w_11w_2) = 1$ folgt $d(w_2) = 0$.
  \end{itemize}

  Da $|w_1| < n$ und $|w_2| < n$, folgt per IV, dass $S \stackrel{*}{ \==>_{\mathcal{G}} } w_1$ und $S \stackrel{*}{\==>_{\mathcal{G}}} w_2$.

  Es folgt mit den Produktionsregeln $S \==>_{\mathcal{G}} 0S1S \stackrel{*}{\==>}_{\mathcal{G}} 0w_11S \stackrel{*}{\==>}_{\mathcal{G}} 0w_11w_2$.

\end{description}
\end{itemize}

%Abk.: \aclu{CFL}: \acs{CFL}\\
%\phantom{Abk.:} \aclu{CFG}: \acs{CFG}

\begin{Def}[name={[Ableitungsbaum]}] Sei $\mathcal{G} = (N, \Sigma, P, S)$ eine kontextfreie Grammatik.
  Definiere die Menge der \emph{Ableitungsbäume von $\mathcal{G}$ beginnend mit $A \in N$}, $\operatorname{Abl(G,A)}$, als Menge von markierten, geordneten Bäumen induktiv durch:
  \begin{itemize}
  \item[] Falls $\pi = A \to w_0A_1w_1\ldots A_nw_n \in P$ mit $A_i \in \N$, $w_i \in \Sigma^*$, $0 \le i \le n$ und $\mathcal{A}_i \in \operatorname{Abl}(G, A_i)$ dann ist
    \begin{center}
			\tikz[baseline=0cm]{\Tree [.$\pi$ $\mathcal{A}_1$ \edge[draw=none]; {$\dots$} $\mathcal{A}_n$ ]} $\in \operatorname{Abl}(G, A)$
    \end{center}
    Abgekürzt: $\pi(\mathcal{A}_1, \ldots, \mathcal{A}_n)$

  \end{itemize}
    Das \emph{abgeleitete Wort zu einem $\mathcal{A} \in \operatorname{Abl}(G, A)$}, $Y(\mathcal{A})$ (,,yield'' von $\mathcal{A}$), ist definiert durch
    \begin{displaymath}
      Y\left(\tikz[baseline=-0.4cm]{\Tree [.$\pi$ $\mathcal{A}_1$ \edge[draw=none]; {$\dots$} $\mathcal{A}_n$ ]} \right) = w_oY(\mathcal{A}_1)w_1\ldots Y(\mathcal{A}_n)w_n
    \end{displaymath}
    wobei $\pi = A \to w_0A_1w_1\ldots A_nw_n \in P$
\end{Def}

\begin{Bsp}\label{bsp:Ableitungsbaum} 
  Einige Ableitungsbäume für die Grammatik $\mathcal{G} = (\{S\}, \{0,1\}, P, S)$ mit
  \begin{displaymath}
    P =
    \begin{aligned}[t]
      \{ S & \to 1S0S \\
        S & \to 0S1S \\
        S & \to \Eps
      \}
    \end{aligned}
  \end{displaymath}
  \begin{description}
  \item[$\operatorname{Abl}(\mathcal{G}, S) = $]\hfill\\
    \tikz[baseline=0cm]{\Tree [ .$S\to\Eps$ ]}
    \quad
    \tikz[baseline=0cm]{\Tree [ .$S\to0S1S$ $S\to\Eps$ $S\to\Eps$ ]}
    \quad
    \tikz[baseline=0cm]{\Tree [ .$S\to1S0S$ $S\to\Eps$ $S\to\Eps$ ]}
    \quad
    \tikz[baseline=0cm]{\Tree [ .$S\to0S1S$ $S\to\Eps$ [ .$S\to\Eps$ $S\to\Eps$ $S\to\Eps$ ] ]}
    \quad
    \dots
  \end{description}
  
	% \begin{figure}[H]\centering
	% 	\begin{subfigure}[t]{.25\linewidth}\centering
	% 		\tikz{\Tree [.$E$ $a$ ]}
	% 		\caption{$E \Rightarrow a$}
	% 	\end{subfigure}
	% 	\begin{subfigure}[t]{.4\linewidth}\centering
	% 		\begin{tikzpicture}[every tree node/.style={execute at begin node=$, execute at end node=$}]
	% 			\Tree [.E (
	% 		          [.E a ]
	% 		          +
	% 		          [.E ( [.E a ] * [.E a ] ) ]
	% 		          )
	% 		        ]
	% 		\end{tikzpicture}
	% 		\caption[$E \xRightarrow{*} (a+(a*a))$]{$E \xRightarrow{*} (a+(a*a)) \newline \longrightarrow E \Rightarrow (E+E)\Rightarrow(E+(E*E))\xRightarrow{*}$}
	% 	\end{subfigure}
	% 	\begin{subfigure}[t]{.3\linewidth}\centering
	% 		\begin{tikzpicture}[every tree node/.style={execute at begin node=$, execute at end node=$}]
	% 			\Tree [.A X_1 X_2 \edge[draw=none]; {\dots} X_n ]
	% 		\end{tikzpicture}
	% 		\caption{$A\rightarrow X_1\dots X_n$}
	% 	\end{subfigure}
	% 	\caption{Ableitungsbäume zu \autoref{bsp:Ableitungsbaum}}\label{fig:Ableitungsbäume}
	% \end{figure}
\end{Bsp}
\begin{lemma}
  Sei $\mathcal{G} = (N, \Sigma, P, S)$ eine kontextfreie Grammatik.

  \begin{displaymath}
    w \in L(\mathcal{G})  \text{ gdw } \exists \mathcal{A} \in \operatorname{Abl}(G, S) \text{ mit } Y(\mathcal{A}) = w
  \end{displaymath}
\end{lemma}

\begin{proof}[,,links nach rechts'']
  Zu zeigen:
  \begin{displaymath}
   \forall n \in \N: \forall w \in \Sigma^*: \forall A \in N: A \stackrel{n}{\==>} w \text{ dann } \exists \mathcal{A} \in \operatorname{Abl}(\mathcal{G}, A) \text{ mit } Y(\mathcal{A}) = w
\end{displaymath}
     Per Induktion über die Länge der Ableitung von $A \stackrel{n}{\==>} w \in \Sigma^*$:
   \begin{description}
   \item[IA] $n=0$ (nichts zu tun, da $A \stackrel{n}{\==>} \Eps$ unmöglich)
   \item[IS] Sei $n > 0$: $A \stackrel{n}{\==>}$ hat die Form
     \begin{displaymath}
       A {\==>} w_0A_1w_1\ldots A_nw_n \stackrel{n-1}{\==>} w
     \end{displaymath}
     Also ist $w = w_0v_1w_1\ldots v_nw_n$ mit $A_i \stackrel{n_i}{\==>} v_i$ für $1 \le i \le n$ und $n_i < n$.\footnote{Dieser Beweisschritt ist nicht ganz präzise\ldots die Ableitungen der $v_i$ sind nicht unbedingt Teil der gesamten Ableitung $A \stackrel{n}{\Longrightarrow} w$.
     Man kann aber beweisen dass eine alternative Ableitung existieren muss, bei der dies der Fall ist.}
   Nach IV ergibt sich
   \begin{displaymath}
     \exists \mathcal{A}_i \in \operatorname{Abl}(G, A_i) \text{ mit } Y(\mathcal{A}_i) = v_i
   \end{displaymath}
   Dann ist $\mathcal{A} = \pi(\mathcal{A}_1,\ldots, \mathcal{A}_n)$ mit $\pi = A \to w_0A_1w_1\ldots A_nw_n \in \operatorname{Abl}(\mathcal{G}, A)$ und $Y(\mathcal{A}) = w_0Y(\mathcal{A}_1)w_1\ldots Y(\mathcal{A}_n)w_n= w_0v_1w_1\ldots v_nw_n$.
   \end{description}
\end{proof}

\begin{proof}[,,rechts nach links'']
  Zu zeigen:
  \begin{displaymath}
    \forall n \in \N: \forall \mathcal{A} \in \operatorname{Abl}(\mathcal{G}, A): \text{falls } Y(\mathcal{A}) = w \text{ dann } A \stackrel{*}{\==>} w
  \end{displaymath}
  \begin{description}
  \item[IS]
\footnote{ Der Induktionsanfang ist bei Ableitungsbäumen ein Spezialfall des Induktionsschritts (Bäume ohne Kinder bzw.\ Regeln, die nur Terminale ableiten) und wird daher nicht gesondert aufgeführt }
    Falls für $n \ge 0$
    \begin{itemize}
    \item  $\mathcal{A} = \pi(\mathcal{A}_1, \ldots, \mathcal{A}_n)$,
    \item $\pi = w_0A_1w_1\ldots A_nw_n$,
    \item $\mathcal{A}_i \in \operatorname{Abl}(\mathcal{G}, A_i)$,
    \item $Y(\mathcal{A}) = w_0Y(\mathcal{A}_1)w_1\ldots Y(\mathcal{A}_n)w_n$
    \end{itemize}
    dann gilt per IV:\footnote{Strengenommen müsste die Folgerung, die hier mit ,,\ldots'' abgekürzt ist noch per Induktion über Ableitungen gezeigt werden} 
    \begin{align*}
      A &\==> w_0A_1\ldots A_nw_n \\
        &\stackrel{*}{\==>} w_0Y(\mathcal{A}_1)\ldots A_nw_n \\
        & \dots \\
        & \stackrel{*}{\==>} w_0Y(\mathcal{A}_1)\ldots Y(\mathcal{A}_n)w_n \\
        &= w
    \end{align*}
  \end{description}
  
\end{proof}

\begin{Def}[name={[Eindeutigkeit von \acs*{CFG} und \acs*{CFL}]}]\
	\begin{itemize}
	\item $\mathcal{G}\in$ \ac{CFG} heißt \emph{eindeutig}, falls es für jedes Wort $\in L(\mathcal{G})$ genau einen Ableitungsbaum gibt.
	\item Eine kontextfreie Sprache heißt \emph{eindeutig}, falls $\exists$ eindeutige \ac{CFG} für sie.
	\end{itemize}
\end{Def}
\begin{Bsp}
	\begin{align*}
		L &= \{ a^ib^jc^k \mid i=j\text{ oder }j=k \}\\
		S &\-> AC \mid DB\\
		A &\-> aAb \mid \Eps & D &\->aD \mid \Eps\\
		C &\->cC \mid \Eps & B &\-> bBc \mid \Eps \quad[\text{für $L$ gibt es keine eindeutige \ac{CFG}}]
	\end{align*}
	Werte der Form $a^nb^nc^n$ haben zwei Ableitungen $\curvearrowright$ Grammatik ist nicht eindeutig.
\end{Bsp}

\datenote{2.12.16}
\subsection{Die Chomsky Normalform für \ac*{CFG}}
Notwendig für das Pumping Lemma kontextfreier Sprachen und für einen effizienten Algorithmus für das \nameref{satz:wortproblem}.


\begin{Def}
  Eine CFG heißt \emph{separiert} wenn jede Produktion entweder die Form
  \begin{itemize}
  \item $A\-> A_1\dots A_n$ \qquad $A_i\in N,n\geq 0$, oder
  \item $A \-> a$ \quad $a\in\Sigma$
  \end{itemize}
  hat.
\end{Def}

\begin{lemma}[\textsc{Sep}]
  Zu jeder CFG gibt es eine äquivalente separierte CFG.
\end{lemma}
\begin{proof}
  Sei $\mathcal{G} = (N, \Sigma, P, S)$ eine CFG.
  Konstruiere $\mathcal{G}' = (N', \Sigma, P', S)$ mit
  \begin{itemize}
  \item $N' = N \uplus \{Y_a \mid a \in \Sigma \}$ (,,$\uplus$'' steht für ,,disjunkte Vereinigung'')
  \item $P' = \{Y_a \to a \mid a \in \Sigma \} \cup \{A \to \beta[a \to Y_a] \mid A \to \beta \in P \}$.
    Die Schreibweise $\beta[a\to Y_a]$ bedeutet hier dass alle $a \in \Sigma$, die in $\beta$ vorkommen durch $Y_a$ ersetzt werden.
  \end{itemize}
Offenbar gilt $L(\mathcal{G}) = L(\mathcal{G'})$ und $\mathcal{G}'$ ist separiert (ohne Beweis).
Der Aufwand für \textsc{Sep} beträgt $O(|\mathcal{G}|)$, wobei 
\begin{displaymath}
  |G| = \sum_{A \in \N}\sum_{A \to \alpha \in P} |A\alpha|
\end{displaymath}
\end{proof}

\begin{lemma}[\textsc{Bin}]
  Zu jeder CFG gibt es eine äquivalente CFG, bei der für alle Produktionen $A \to \alpha$ gilt, dass $|\alpha| \le 2$.
\end{lemma}
\begin{proof}
  Ersetze jede Produktion der Form 
  \begin{displaymath}
    A \to X_1X_2\ldots X_n
  \end{displaymath}
  mit $X_i \in N \cup \Sigma$, $1 \le i \le n$,
  durch die Regeln 
  \begin{align*}
    A &\to X_1\langle  X_2\ldots X_n \rangle \\
    \langle  X_2\ldots X_n \rangle & \to X_2\langle  X_3\ldots X_n \rangle \\
    \vdots \\
    \langle  X_{n-1}X_n \rangle & \to X_{n-1}X_n
  \end{align*}
  Dabei sind  $\langle  X_2\ldots X_n \rangle$, \ldots, $\langle  X_{n-1}\ldots X_n \rangle$ neue Nichterminalsymbole.

  Der Aufwand von \textsc{Bin} liegt in $O(|G|)$.
\end{proof}


\begin{Def}
  Sie $\mathcal{G} = (N, \Sigma, P, S)$ eine CFG.
  Definiere die Menge $\operatorname{Nullable}(\mathcal{G}) \subseteq N$ als
  \begin{displaymath}
    \operatorname{Nullable}(\mathcal{G}) = \{ A \in \N \mid A \stackrel{*}{\==>} \Eps \}
  \end{displaymath}
  Es handelt sich um die Menge an Nichtterminalen, aus denen das leere Wort abgeleitet werden kann.
\end{Def}

\begin{Satz}
  Es gibt einen Algorithmus, der $\operatorname{Nullable}(\mathcal{G})$ in $O(|\mathcal{G}|^2)$ ausrechnet.
\end{Satz}
\begin{proof}
  Definiere $M_i$ als die Menge der Nichtterminale, aus denen sich
  $\Eps$ mit einem Ableitungsbaum der Höhe $< i$ ableiten lässt:
  \begin{align*}
    M_0 &= \emptyset \\
    M_{i+1} &= M_i \cup \{ A \mid A \to \alpha \in P \text{ und }
              \alpha \in M_i^* \}
  \end{align*}
  Es gilt für alle $i \in \N$, dass $M_i \subseteq N$.
  Da $|N|$ endlich ist, existiert ein $m \in \N$, so dass
  \begin{displaymath}
    M_m = M_{m+1} = \bigcup_{i \in \N} M_i
  \end{displaymath}
  Das bedeutet, $\bigcup_{i \in \N} M_i$ lässt sich iterativ berechnen (s.u.).

  Wir zeigen nun, dass $\operatorname{Nullable}(\mathcal{G}) = \bigcup_{i \in \N} M_i$.

  \paragraph{,,$\supseteq$''}
  Es ist zu zeigen, dass $\forall i \in \N: M_i \subseteq \operatorname{Nullable}(\mathcal{G})$

  Per Induktion über $i$:
  \begin{description}
  \item[IA] $i = 0$, $M_0 = \emptyset \subseteq \operatorname{Nullable}(\mathcal{G})$
  \item[IS] $i \Rightarrow i+1$

    Wenn $A \in M_{i+1}$, dann ist
    \begin{itemize}
    \item entweder
      $A \in M_i \subseteq \operatorname{Nullable}(\mathcal{G})$ nach
      IV oder
    \item 
      es existiert $A \to A_1\ldots A_n \in P$ mit $A_j \in M_i$ für
      $1 \le j \le n$.
      Per IV existieren Ableitungen
      \begin{displaymath}
        A_j \stackrel{*}{\==>} \Eps
      \end{displaymath}
      denen kann die obige Produktion vorangestellt werden, sodass auch
      eine Ableitung von $A$ nach $\Eps$ existert.
      \begin{displaymath}
        A  \==> A_1 \ldots A_n \stackrel{*}{\==>} \underbrace{\Eps \ldots \Eps}_{n \text{ mal}} = \Eps
      \end{displaymath}
      Also gilt $A \in \operatorname{Nullable}(\mathcal{G})$
    \end{itemize}
  \end{description}

  
  \paragraph{,,$\subseteq$''}
  Wenn $A \in \operatorname{Nullable}(\mathcal{G})$, dann existiert $m
  \in \N$, so dass $A \stackrel{*}{\==>} \Eps$ mit einem
  Ableitungsbaum der Höhe $m$.
  Wir zeigen per Induktion über $m$, dass $A \in M_{m+1} \subseteq \bigcup_{i \in \N} M_i$.
  \begin{description}
  \item[IA] $m = 0$. Die Ableitung ist $A \==> \Eps$, sodass $A\in M_1$.
  \item[IS] $m > 0$.
    Die Wurzel des Ableitungsbaum muss mit $A \to A_1\ldots A_n$ ($n>0$)
    markiert sein und die Kinder sind jeweils Ableitungsbäume für
    $\Eps$ in  $Abl(\mathcal{G}, A_i)$, wobei $1 \le i \le n$ und
    deren Höhe jeweils $m_i < m$ ist.
    Es gilt nun per IV, dass $A_i \in M_{m_i} \subseteq M_{m-1}$.
    Somit ist $A_i \in M_{m-1}$ und damit, per Definition, $A \in M_m$.
  \end{description}
\end{proof}
Aus dem Beweis ergibt sich der folgende Algorithmus zur Berechnung von $\bigcup_{i \in \N} M_i$.
\begin{itemize}
\item Eingabe: CFG $\mathcal{G} = (N, \Sigma, P, S)$
\item Ausgabe: $\operatorname{Nullable}(\mathcal{G})$
\item[] $M = \emptyset$
\item[] $\mathit{done} = \mathtt{false}$
\item[] $\mathbf{while} (\mathit{not}~\mathit{done})$
  \begin{itemize}
  \item[] $\mathit{done} = \mathtt{true}$
  \item[] $\mathbf{for}~(A \to \alpha \in P)$
    \begin{itemize}
    \item[] $\mathbf{if}~(A \not \in M \land \alpha \in M^*)$
      \begin{itemize}
      \item[] $M = M \cup \{A \}$
      \item[] $\mathit{done} = \mathtt{false}$
      \end{itemize}
    \end{itemize}
  \end{itemize}
\item[] $\mathbf{return}~M$
\end{itemize}
\begin{Korollar}
  Es gibt einen Algorithmus, der zu einer CFG $\mathcal{G}$ berechnet ob $\Eps \in L(\mathcal{G})$.
\end{Korollar}
\begin{proof}
  Prüfe ob $S \in \operatorname{Nullable}(\mathcal{G})$
\end{proof}
\begin{lemma}[\textsc{Del}]
  Zu jeder CFG $\mathcal{G}=(N, \Sigma, P, S)$ gibt es eine äquivalente CFG $\mathcal{G'} =(N', \Sigma, P', S')$, bei der die einzige $\Eps$-Regel $S' \to \Eps$ ist (falls $\Eps \in L(\mathcal{G})$).
\end{lemma}
\begin{proof}
  \begin{enumerate}
  \item Erweitere $\mathcal{G}$ um ein neues Startsymbol $S'$ mit $S' \to S$ als neue Produktion.
    Dieser Schritt stellt sicher, dass $S'$ auf keiner rechten Regelseite vorkommt.
  \item Wende erst \textsc{Sep}, dann \textsc{Bin} an.
    Nun hat jede rechte Regelseite die Form $a \in \Sigma$ oder $\Eps$ oder $A$ oder $BC$.
  \item Sei $M = \operatorname{Nullable}(\mathcal{G}')$.
  \item Für alle Regeln $A \to BC \in P$:
    \begin{itemize}
    \item Falls $B \in M$ füge $A \to C$ hinzu.
    \item Falls $C \in M$ fürge $A \to B$ hinzu.
    \end{itemize}
  \item Falls $S \in \operatorname{Nullable}(\mathcal{G})$ füge $S' \to \Eps$ hinzu
  \item Entferne alle Produktionen $A \to \Eps$ für $A \neq S'$.
  \end{enumerate}
\end{proof}


\begin{Def}[name={[\acs*{CFG} in \acs*{CNF}]}]
	Eine \ac{CFG} ist in \ac{CNF}, falls jede Produktion die Form $A\->a$ oder $A\->BC$ hat, wobei $A,B,C\in N$, $a\in\Sigma$.
\end{Def}




\begin{Beobachtung}
	$\mathcal{G}$ in \ac{CNF} $\curvearrowright \Eps \notin L(\mathcal{G})$
\end{Beobachtung}
	
% \paragraph*{Transformation} einer Grammatik $\mathcal{G}$ mit $\Eps\notin L(\mathcal{G})$ nach \ac{CNF}.

% \paragraph*{1. Schritt:} Separierte Grammatik\\
% d.h. jede Regel hat die Form
% \begin{alignat*}{2}
% 	A&\-> A_1\dots A_n &\qquad A_i&\in N,n\geq 0\\
% 	\text{oder}\quad A &\-> a & a&\in\Sigma
% \end{alignat*}
% \emph{Verfahren:}
% \begin{itemize}
% \item Erweitere $N$ um neue \acs{NT} $\{Y_a \mid a\in\Sigma\}$
% \item Zusätzliche neue Regeln $Y_a\-> a$
% \item Ersetze in den "`alten"' Regeln alle Terminale $a$ durch $Y_a$
% \item[$\curvearrowright$] Grammatik separiert, Sprache ist unverändert.
% \end{itemize}

% \paragraph*{2. Schritt:} Eliminiere alle Regeln der Form $A\->\Eps$ ($\Eps$-Produktion)\\
% Ziel: $\Eps$-freie Grammatik.\\
% Gesucht: $M=\{ A \mid A \xRightarrow{*}\Eps \} \subseteq N$
% \begin{alignat*}{2}
%     \text{Def.:}&\quad& M_0 &= \{ A \mid A\-> \Eps \}\\
%     &\forall i\in\N& M_{i+1} &= M_i\cup \{ A \mid A\->\alpha, \alpha \in M_i^* \}\\
%     \text{Es gilt }&\forall i\in\N& M_i &\subseteq N \text{ endlich}\\
%     && \curvearrowright\quad \exists n\in\N &: M_n = M_{n+1} = \bigcup_{i\in\N} M_i\\[.5em]
%     \text{Beh.:}&& M&=\bigcup\limits_{i\in\N} M_i\\
%     \forall i\in\N :&& M_i &\subseteq M\\
%     i=0 :&& \quad M_0 &= \{ A \mid A\-> \Eps \in P \} \subseteq M\\
%     i>0 :&& M_{i+1} &= M_i\cup \{ A \mid A\-> \alpha,\alpha\in M_i^* \}
% \end{alignat*}
% \begin{alignat*}{2}
%     &\text{Falls}\quad& A &\->A_1\dots A_n\in P,\ A_j\in M_i\\
%     &\text{dann} & A &\=> A_1\dots A_n\\
%     &&&\xrightarrow{\text{I.V.}} A_2\dots A_n\\
%     &&&\ \vdots\\
%     &&&\xrightarrow{\text{I.V.}} A_n\\
%     &&&\xrightarrow{\text{I.V.}} \Eps\\
%     &\curvearrowright & A &\in M\\
%     &\-> & \bigcup_{i\in\N} M_i &\subseteq M
% \end{alignat*}
% Zeige noch $M\subseteq \bigcup\limits_{i\in\N} M_i$

% Sei $A\in M : A\xRightarrow{*} \Eps$ mit Ableitungsbaum der Höhe $h+1$, dann: $A\in M_h$

% \emph{h=0:} Ableitungsbaum \quad \tikz[baseline=(a.base)]{\Tree [.\node (a) {$A$}; $\Eps$ ]} \quad $A\->\Eps \curvearrowright A\in M_0$

% \emph{h>0:}
% \tikz[baseline=(a.base)]{
%     \Tree [.\node (a) {$A$}; [.$A_1$ \edge[roof]; {$\Eps$} ]
%                              [.$A_2$ \edge[roof]; {$\Eps$} ]
%                              [.$\dots$ ]
%                              [.$A_n$ \edge[roof]; {$\Eps$} ]
%           ]
% }

% so dass $A_j \=>^* \Eps$ mit Ableitungsbaum der Höhe $<h+1$

% Nach I.V. $A_j\in M_{h-1}$ und $A \-> A_1\dots A_n \in P$, so dass $ A \in M_h$.


% %
% %
% Transformation im \ac{CNF} (Fortsetzung)
% \begin{enumerate}
% \item Schritt: Separierte Grammatik: $\A\->A_1\dots A_n$ oder $A\-> a\ ,\ A_i\in N$
% \item Schritt: $\Eps$-freie Grammatik, bereits bestimmt:
% 	\[ M=\{A \mid A\=> \Eps \} \]
% 	inkl. Algorithmus dazu: berechne $M_i$ f"ur $i=0, 1, \dots$ bis keine neuen NT hinzukommen. 
	
% 	Anpassen der Produktionen
% 	\begin{enumerate}
% 		\item\label{itm:Prod-b} Falls Regel $A\-> A_1\dots A_n\in P$ und $\exists j:A_j\in M$, dann füge neue Regel\\
% 			$A\->A_1\dots A_{j-1} A_{j+1}\dots A_n$ zu $P$ hinzu.
% 		\item Wiederhole \nameref{itm:Prod-b} bis keine neuen Regeln erzeugt werden können.
% 		\item Entferne alle $\Eps$-Regeln.
% 	\end{enumerate}
% 	Ergebnis: Grammatik, die $\Eps$-frei ist und die gleiche Sprache erzeugt (o.B.).

% \item Schritt: Beseitige Kettenregeln der Form $A\-> B$
% 	\begin{itemize}
% 		\item Betrachte den gerichteten Graphen mit Knotenmenge $N$ und den Kettenregeln als Kanten.
% 		\item Suche Zyklus mit Tiefensuche $A_1\->A_2\->\dots\->A_r\->A_i$. Dann ersetzt Vorkommen von $A_j\ (j>1)$ durch $A_1$ (auf linker und rechter Seite aller Produktionen).
% 		\item Wiederhole bis alle Zyklen eliminiert.
% 		\item Betrachte topologische Sortierung des verbleibenden \acsu{DAG}: $B_1\dots B_m$, so dass $B_m$ keine Kettenregel besitzt.
% 		\item Starte mit $B_m$ mit Produktion $B_m\->\alpha_i \mid \dots \mid \alpha_k$\\
% 			Ersetze alle Vorkommen von $B_m$ auf der rechten Seite von Kettenproduktionen durch $\alpha_1 \mid \dots \mid \alpha_k$
% 		\item Wiederhole f"ur $B_{m+1}\dots B_1$\\
% 			$\curvearrowright$ alle Kettenproduktionen eliminiert.
% 	\end{itemize}
% \item Schritt: jetzt haben alle Produktionen die Form $A\-> A_1\dots A_n$, $n\geq 2$ oder $A\-> a$.
% 	\begin{itemize}
% 		\item Falls $A\-> A_1 A_2\dots A_n \in P$ mit $n>2$ dann ersetze durch zwei neue Produktionen
% 		\begin{align*}
% 			A &\-> A_1 B & \text{mit $B$ neues \acs{NT}}\\
% 			B &\-> A_2\dots A_n 
% 		\end{align*}
% 		\item Wdhl. bis alle rechten Seiten eine L"ange $\le2$ haben.
% 	\end{itemize}
% 	$\curvearrowright$ \ac{CNF} erreicht.
% \end{enumerate}
% \begin{Bemerkung} Sei $|\mathcal{G}|=\sum\limits_{A\->\alpha\in P}(|\alpha|+1)$ die Gr"o"se einer CFG.\\
% Die Transformation nach \ac{CNF} benötigt Zeit $O(|\mathcal{G}|^2)$. Die Größe der \ac{CNF}-Grammatik ist $O(|\mathcal{G}|^2)$.
% \end{Bemerkung}

\subsection{Pumping Lemma für \acs*{CFL}}
\begin{Satz}[Pumping lemma für \acs*{CFL}, uvwxy Lemma]
\label{satz:PL für CFL}
%\rlnote{Satz \# 4.2?}
	Sei $L\in {CFL}$. Dann $\exists n>0$, so dass $\forall z\in L$ mit $|z|\geq n\ \exists u,v,w,x,y:$ mit
	\begin{itemize}
	\item $z=uvwxy$
	\item $|vwx|\leq n$
	\item $|vx|\geq 1$
	\item $\forall i \in \N : uv^iwx^iy\in L$
	\end{itemize}
\end{Satz}
\begin{proof}
	Sei $\mathcal{G}= (N,\Sigma,P,S)$ in \ac{CNF} mit
    $L(\mathcal{G}) = L\setminus\{\Eps\}$.
    
	Sei $k = |N|$ und wähle $n=2^k$
	
	Betrachte den Ableitungsbaum $B$ von $z$ mit $|z|\geq n$.
	\begin{itemize}[label=$\curvearrowright$]
		\item $B$ ist (im wesentlichen) ein Binärbaum mit $|z|\geq n = 2^k$ Blättern.
		\item in einem solchen Bin"arbaum $B$ $\exists$ Pfad  der Länge $\geq k$.
	\end{itemize}
	Auf diesem Pfad liegen $\geq k+1$ \acfp{NT}\\
	Also: mindestens ein \ac{NT} $A$ muss mehrmals auf dem Pfad vorkommen. Suche so ein $A$ beginnend vom Blatt dieses Pfads, dann ist das zweite Vorkommen von $A\leq k$ Schritte vom Blatt entfernt.
	
	Aufgrund der Wahl von $A$ hat der Ableitungsbaum für $A \=>^* vAx \xRightarrow{*} vwx$ Höhe $\leq k$.
	\begin{itemize}[label=$\curvearrowright$]
		\item hat $\leq 2^k=n$ Blätter
		\item $|vwx|\leq 2^k =n$
	\end{itemize}
	Es gilt $|vx|\geq 1$, weil
	\begin{itemize}
		\item Ableitungsbaum ist Binärbaum, mit inneren Knoten $A \-> BC$
		\item Pfad belegt nur eine Abzweigung
		\item Wegen \ac{CNF} $\not\exists C, C\xRightarrow{*} \Eps$
	\end{itemize}
		\begin{figure}[H]\centering
		\begin{subfigure}[b]{.29\linewidth}\centering
			\begin{tikzpicture}[node distance=.75cm, on grid,
					every node/.style={
						execute at begin node=$,
						execute at end node=$
					}
				]
				\node (0) {};
				\node (A1) [below=of 0] {A};
				\node (A2) [below=of A1] {A};
				\node (A3) [below=of A2] {A};
				
				\newlength\Offset \setlength\Offset{.75cm}
				\coordinate(p1) at ($(A2.south) - (0,\Offset)$);
				%
				\coordinate (A2l) at ($(p1) - (\Offset,0)$);
				\coordinate (A1l) at ($(A2l) - (\Offset,0)$);
				\coordinate (0l) at ($(A1l) - (\Offset,0)$);
				%
				\coordinate (A2r) at ($(p1) + (\Offset,0)$);
				\coordinate (A1r) at ($(A2r) + (\Offset,0)$);
				\coordinate (0r) at ($(A1r) + (\Offset,0)$) ;
				
				\coordinate (A3l) at ($(A3.south) - (\Offset,\Offset)$);
				\coordinate (A2l2) at ($(A3l) - (\Offset,0)$);
				%
				\coordinate (A3r) at ($(A3.south) + (\Offset,-\Offset)$);
				\coordinate (A2r2) at ($(A3r) + (\Offset,0)$);
				
				\node (dots) [below=\Offset of A3] {\vdots};
				
				\node (A4) [below=\Offset of dots] {A};
				\coordinate (A4l) at ($(A3l) - (0,2*\Offset)$);
				\coordinate (A4r) at ($(A3r) - (0,2*\Offset)$);
				
				\draw (0.south) edge (0l.center) edge (0r.center)
					(A1.south) edge (A1l.center) edge (A1r.center)
					(A2.south) edge (A2l2.center) edge (A2r2.center)
					(A3.south) edge (A3l.center) edge (A3r.center)
					(A4.south) edge (A4l.center) edge (A4r.center)
				;
				\draw (0l.center) edge node[below] {u} (A1l.center)
					(A1l.center)  edge node[below] {v} (A2l.center)
					(A2r.center)  edge node[below] {x} (A1r.center)
					(A1r.center)  edge node[below] {y} (0r.center)
					(A2l2.center) edge node[below] {v} (A3l.center)
					(A3r.center)  edge node[below] {x} (A2r2.center)
					(A4l.center)  edge node[below] {w} (A4r.center)
				;
			\end{tikzpicture}
			\caption{$uv^iwx^iy\in L$}
		\end{subfigure}
		\begin{subfigure}[b]{.28\linewidth}\centering
			\begin{tikzpicture}[node distance=.5cm, on grid,
					every node/.style={
						execute at begin node=$,
						execute at end node=$
					},
					widebox/.style={draw, minimum width=.75cm, minimum height=.35cm, inner sep=0pt}
				]
				\node (S) {S};
				\node[inner sep=2pt] (A) [below=of S.south, xshift=.2cm] {A};
				\coordinate (Ap) at (A.south west);
				\node[widebox] (w) [below=of Ap] {w};
				\node[widebox] (u) at ($(Ap)!2!(w.north west)+.5*(-.75,-.3)$) {u};
				\node[widebox] (y) at ($(Ap)!2!(w.north east)+.5*(.75,-.3)$) {y};
				
				\draw (S.south) edge (u.north west) edge (y.north east)
					(Ap) edge (u.north east) edge (y.north west) edge (w.north)
					($(S.south) - (.25,.6)$) edge (S.south) edge (Ap)
				;
			\end{tikzpicture}
			\caption{$\curvearrowright uwy\in L$}
		\end{subfigure}
		\begin{subfigure}[b]{.33\linewidth}\centering
			\begin{tikzpicture}[>=stealth,
				widebox/.style={draw, minimum width=.75cm, minimum height=.35cm, inner sep=0pt}
				,dot/.style={inner sep=0pt,outer sep=0pt,label={center:\scalebox{.75}{\textbullet}}}
				]
				
				\node[dot,label={above right:$S$}] (v1) at (0,-1) {};
				\node[dot] (v2) at (-0.25,-1.6) {};
				\node[dot,label={above right:$A$}] (v3) at (0,-2) {};
				\node[dot] (v4) at (-0.5,-2.5) {};
				\node[dot,label={above right:$A$}] (v5) at (0,-3) {};
				\node[widebox] (v6) at (-1.5,-3.5) {$u$};
				\node[widebox] (v7) at (-.75,-3.5) {$v$};
				\node[widebox] (v8) at (0,-3.5) {$w$};
				\node[widebox] (v9) at (.75,-3.5) {$x$};
				\node[widebox] (v10) at (1.5,-3.5) {$y$};
				
				\draw  (v1) edge (v2);
				\draw  (v2) edge (v3);
				\draw  (v3) edge (v4);
				\draw  (v4) edge (v7.north west);
				\draw  (v4) edge (v5);
				\draw  (v3) edge (v10.north west);
				\draw  (v5) edge (v8.north west);
				\draw  (v5) edge (v8.north east);
				\draw  (v1) edge (v6.north west);
				\draw  (v1) edge (v10.north east);
				\node[align=left, text height=3em,inner sep=2pt] at (2.1,-1.5) {$A\rightarrow BC$\small{ist Binärbaum}} edge[->,shorten >=.1cm] (v3);
				\node[inner sep=0pt] at (2.75,-3.5) {$A\rightarrow a$} edge[->] (v10);
				\node (v11) at (0,-4) {$z$};
				\draw[semithick]
				let \p1 = (v6.west), \p2 = (v11), \p3 = (v10.east) in 
				 (\x1,\y2) edge[{Bar[]<}-] (v11) (v11) edge[-{>Bar[]}] (\x3,\y2);
			\end{tikzpicture}
			\caption{$\exists$ Pfad mit Länge $\geq k$}
		\end{subfigure}
		\caption{Schema zu \autoref{satz:PL für CFL}}
	\end{figure}\vspace{-2em}\qedhere
\end{proof}

\begin{lemma} %\rlnote{Lemma \# 4.3?}
	$\mathcal{L}_2 \subsetneq \mathcal{L}_1$
\end{lemma}
\begin{proof}
	Sei $L=\{L=\{a^nb^nc^n \mid n\geq 1\}$.\\
	$L$ ist nicht kontextfrei. Verwende \ac{PL}. Angenommen $L\in {CFL}$.\\
	Sei $n$ die Konstante aus dem \ac{PL}.
	
	Wähle $z=a^nb^nc^n$
	\begin{align*}
		\text{Also: } \exists &u,v,w,x,y : z = uvwxy\\
		& |vwx| \leq n
	\end{align*}
	$\curvearrowright vwx$  kann nicht gleichzeitig $a,b$ und $c$ enthalten.\\
	Angenommen $vwx$ enthält kein $c$. Dann muss $uwy \in L$
	\begin{itemize}
		\item $y$ endet mit $c^n$
		\item $|vx|\geq 1$, also $|uwy|+1\leq |z|$ also "`fehlt"' mindestens ein $a$ oder $b$
	\end{itemize}
	$\curvearrowright uvw \notin L$
\end{proof}

\subsection{Entscheidungsprobleme für \acs*{CFL}}
\begin{Satz}[name={[Wortproblem für \acs*{CFL} entscheidbar]}]
	Das Wortproblem "`$w\in L?$"' ist für \ac{CFL} entscheidbar. Falls $|w|=n$, benötigt der Algorithmus $O(n^3)$ Schritte und $O(n^2)$ Platz.
\end{Satz}
\begin{proof}
	Algorithmus \ac{CYK}.
\end{proof}
\begin{Bsp}
	$L=\{a^nb^nc^m \mid n,m\geq 1\}$ mit Grammatik (\acs{CFG})
	\begin{align*}
		S &\-> XY\\
		X &\-> ab \mid aXb\\
		Y &\-> c \mid cY\\
		\shortintertext{Umformen in \ac{CNF}}
		S &\-> XY & A &\->a\\
		X &\-> AB \mid AZ & B&\->b\\
		Y &\->c \mid CY & C &\->c\\
		Z &\-> XB
	\end{align*}
\end{Bsp}

	$\begin{aligned}[t]
		S &\-> XY\\
		X &\-> AB\\
		X &\-> AZ\\
		Z &\-> XB\\
		Y &\-> c\\
		Y &\-> CY\\
		A &\-> a\\
		B &\-> b\\
		C &\-> c
	\end{aligned}$\quad
\begin{proof}
		\ac{CYK}-Algorithmus
		\begin{description}
	    \item[Eingabe:]
		\begin{itemize}
			\item \ac{CFG} $\mathcal{G}$ in \ac{CNF}
			\item $w = a_1\dots a_n\in\Sigma^*, |w|=n$
		\end{itemize}
		\item[Ausgabe:] "`$w\in L(\mathcal{G})$"'
		\item[Idee:] Berechne eine $(n\x n)$ Matrix $M$ mit Einträgen in $\mathcal{P}(N)$ mit folgender Spezifikation:
		\end{description}
	\begin{align*}
		M_{ij} &= \{ A \mid A\xRightarrow{*} a_i\dots a_j \} && 1\leq i\leq j\leq n \quad\text{nur diese }M_{ij}\neq \varnothing\\
		& \text{falls $i=j$:}\\
		M_{ii} &= \{ A \mid A\xRightarrow{*} a_i\}\\
		&= \{A \mid A\-> a_i \} \\
		&\text{falls }1\leq i<j\leq n:\\
		M_{ij} &= \{ A \mid A\xRightarrow{*} a_i\dots a_j \}\\
		&= \{ A \mid A\=> BC \xRightarrow{*} a_i\dots a_j \}\\
		&= \{ A \mid A\-> BC \land BC \xRightarrow{*} a_i\dots a_j \}\\
		&= \{ A \mid A\-> BC \land \exists k: i\leq k<j\quad 
			\begin{aligned}[t]
				B &\xRightarrow{*} a_i\dots a_k \land{}\\
				C &\xRightarrow{*} a_{k+1}\dots a_j \}
			\end{aligned}\\
		&= \bigcup_{k=i}^{j-1} \{ A \mid A \-> BC \land 
			\begin{aligned}[t]
				B &\xRightarrow{*} a_i\dots a_k \land{}\\
				C &\xRightarrow{*} a_{k+1}\dots a_j \}
			\end{aligned}\\
		&= \bigcup_{k=i}^{j-1} \{ A \mid A \-> BC \land B \in M_{i,k} \land C \in M_{k+1,j} \}
	\end{align*}
	Damit: $w\in L$ genau dann, wenn $S \=>^* w$ genau dann, wenn $S \in M_{1,n}$.
	
	\begin{table}[H]\centering
		\caption[$w=aaa\ bbb\ cc$]{$w=aaa\ bbb\ cc$ \protect\footnotemark}
		\begin{tabular}[t]{M{c}|*8{M{c}|}}
		\cline{2-9}
			M = & A               & \bullet & \bullet & \bullet & \bullet & \color{Green}X & \color{Green}\emph{S} & S       \\
		\cline{2-9}
			\multicolumn{2}{c|}{} & \color{Blue}A       & \bullet & \bullet & \color{Red}\color{Blue}{X} & \color{Red}{Z} & \bullet & \bullet \\
		\cline{3-9}
			     \multicolumn{3}{c|}{}      & A       & X       & \color{Blue}Z       & \bullet & \bullet & \bullet \\
		\cline{4-9}
			          \multicolumn{4}{c|}{}           & B       & \bullet & \bullet & \bullet & \bullet \\
		\cline{5-9}
			               \multicolumn{5}{c|}{}                & B       & \bullet & \bullet & \bullet \\
		\cline{6-9}
			                    \multicolumn{6}{c|}{}                     & \color{Red}B & \bullet & \bullet \\
		\cline{7-9}
			                         \multicolumn{7}{c|}{}                          & C,\color{Green}Y     & Y       \\
		\cline{8-9}
			                              \multicolumn{8}{c|}{}                               & C,Y     \\
		\cline{9-9}
		\end{tabular} $M_{1n}$
	\end{table}\footnotetext{Zur Veranschaulichung: das Unterstrichene wird aus den Elementen der entsprechenden Farbe gebildet.}
\end{proof}

$\acs{CYK}(\mathcal{G},a_1,\dots,a_n)$\\
$M\ n\x n$ Matrix mit $M_{ij}=\varnothing$
\begin{lstlisting}[mathescape,morekeywords={for,do,return},morecomment={[l]{//}}]
  for i=1 .. n do  // $O(|\mathcal{G}|)\cdot O(n)$
    $M_{ii}=\{A \mid A \-> a_i \}$
  for i=n-1 ..  1 do
    for j=i+1 .. n do
      for k=i .. j-1 do  // $O(|\mathcal{G}|)\cdot O(n^3)$
        $M_{ij}=M_{ij}\cup \{ A \mid A \-> BC, B\in M_{ik}, C\in M_{k+1,j} \}$
  return $S\in M_{1n}$
\end{lstlisting}

\begin{Satz}[name={[Entscheidbarkeit des Leerheitsproblems für \acs*{CFL}]}] % 4.7
    Das Leerheitsproblem ist für \ac{CFL} entscheidbar.
\end{Satz}

\begin{proof}
    Sei $\mathcal{G} = (N, \Sigma, P, S)$ eine CFG für $L$.
    Gefragt ist, ob $L(\mathcal{G}) = \{ w\in\Sigma^* \mid S\overset{*}{\=>} w \} \overset?= \varnothing
$. 
    Betrachte dazu die Menge $M$ der nützlichen Nichtterminalsymbole, aus denen ein Terminalwort herleitbar ist.
	\begin{align*}
		M &= \{ A \mid A \overset{*}{\=>} w, w\in \Sigma^* \}\\
		M_0 &= \{ A \mid A \-> w\in P, w\in \Sigma^* \}\\
		M_{i+1} &= M_i\cup \{ A \mid A \-> \alpha\in P, \alpha\in(\Sigma\cup M_i)^* \}\\
		\exists n : M_n &= M_{n+1} \overset!= M\\
		L =\varnothing &\<=> S\notin M \qedhere
	\end{align*}
	Offenbar ist $M_0 \subseteq M$ eine Approximation von $M$, $M \supseteq M_{i+1} \supseteq M_i$ verbessert $M_i$ und das jeweils nächste $M_i$ ist in Linearzeit berechenbar. Da $M \subseteq N$ endlich ist, muss es ein $n$ geben, sodass $M_n = M_{n+1}$. Für dieses $n$ kann man zeigen, dass $M = M_n$. 
\end{proof}
\begin{Bem}
	$M$ ist die Menge der nützlichen Nichterminale. Nicht nützliche Nichtterminale können entfernt werden, ohne dass $L(\mathcal{G})$ sich ändert.
\end{Bem}
\begin{Satz}[name={[Entscheidbarkeit des Endlichkeitsproblem für \acs*{CFL}]}]
	Das Endlichkeitsproblem für \ac{CFL} ist entscheidbar.
\end{Satz}
\begin{proof}
	Mit \ac{PL} analog zum Endlichkeitsproblem für reguläre Sprachen.
\end{proof}

\subsection{Abschlusseingenschaften für \acs*{CFL}}


\begin{Satz} % 4.7
	Die Menge \acs{CFL} ist abgeschlossen unter $\cup, \cdot, ^*$, jedoch \emph{nicht} unter $\cap, \overline{\phantom{A}}$.
\end{Satz}
\begin{proof}
	\begin{align*}
		\mathcal{G}_i :&= (N_i, \Sigma,P_i,S_i) \quad i=1,2\\
		\text{"`}\cup\text{"'}: N &= N_1\dotcup N_2\dotcup\{S\}\\
		P &= \{S\->S_1, S\->S_2 \} \cup P_1\cup P_2\\
		\text{"`}\cdot\text{"'}:: N &= N_1\dotcup N_2\dotcup\{S\}\\
		P &= \{ S\->S_1S_2 \} \cup P_1\cup P_2\\
		\text{"`}^*\text{"'}: N &= N_1 \dotcup \{S\}\\
		P &= \{ S\->\Eps, S\-> S_1S \} \dotcup P_1
	\end{align*}
	\begin{itemize}
	\item für $n\geq 1$
		\[ \underbrace{\{a^nb^nc^n\}}_{\notin \acs{CFL}} = \underbrace{\{a^nb^nc^m \mid n,m\geq 1 \}}_{\in \acs{CFL}} \cap \underbrace{\{a^mb^nc^n \mid m,n\geq 1 \}}_{\in \acs{CFL}} \]
		Also \ac{CFL} nicht abgeschlossen unter $\cap$.
	\item Angenommen \ac{CFG} abgeschlossen unter $\overline{\phantom{X}}$\\
		Falls $L_1,L_2\in \acs*{CFL}$, dann ist $\overline{L}_1,\overline{L}_2\in\acs*{CFL}$ nach Annahme.\\
		$\curvearrowright \overline{L}_1\cup \overline{L}_2\in\acs*{CFL}$ wegen Teil "'$\cup$"'.\\
		$\curvearrowright \overline{\overline{L}_1\cup \overline{L}_2} = L_1\cap L_2\in\acs*{CFL}\ \lightning$ zu Teil "'$\cap$"'. \qedhere
	\end{itemize}
\end{proof}

\begin{Satz} % 4.8
	Die Menge \ac{CFG} ist abgeschlossen unter $\cap$ mit reg. Sprachen. "`$\acs*{CFL} \cap \text{REG} = \acs*{CFL}$"'.
\end{Satz}
\begin{proof}
	\begin{align*}
			\text{Sei }L &= L(\mathcal{G})\quad\acs{CFL}\\
			R &= L(M)\quad\acs{REG}\\
			\mathcal{G} &= (N,\Sigma,P,S)\\
			M &= (Q,\Sigma,\delta,q_0,F)\quad\acs{DFA}
	\end{align*}
	Zeige $L\cap R$ \acs{CFL}\\
	Konstruiere \ac{CFG} für $L\cap R$\\
	Ang. $\mathcal{G}$ ist in \ac{CNF}
	\begin{alignat*}{2}
		A &\-> a &\quad& A \-> BC\\
		\tikz[baseline]{\Tree [.$qAq'$ $a$ ]}
			&= \delta(q,a) &&\qquad \mathclap{%
				\tikz[baseline]{\Tree [.$q_1Aq_3$ $q_1Bq_2$ $q_2Cq_3$ ]}
			}\\
		N' &= Q\x N\x Q\cup \{S'\}\\
		S' &\-> (q_0,S,q')\ && \forall q'\in F\\
		(q,A,q') &\-> a && \text{falls } \delta(q,a) = q'\text{ und }A\-> a\in P\\
		(q_1, A, q_3) &\-> (q_1,B,q_2)(q_2,C,q_3) &&\text{falls } A\-> BC\in P \forall q_1,q_2,q_3\in Q
	\end{alignat*}
	Zeige $(p,A,q)\overset*{\=>} w \<=> \exists$ Lauf $p\dots q$ von $M$ auf $w$ und $A \Rightarrow^* w$\\
	per Induktion über Höhe $h$ des Ableitungsbaums:
	\begin{itemize}[labelwidth=\widthof{$h=1:$},leftmargin=!]
	\item[$h=1:$] $(p,A,q) \-> a\ \exists$ Lauf denn $\delta(p,a)=q$; offenbar $A\Rightarrow a$
	\item[$h>1:$] $(p,A,q) \-> (p,\underset{\Downarrow*}{B},r)(r,\underset{\Downarrow*}{C},q)$\\
	\hspace{-2em}mit $w\phantom{A}\,=\phantom{(p,\,} w_1 \phantom{,r)(r,\ }w_2$
	\end{itemize}
	und Höhen $<h:$\\
	Nach IV $\exists$ Lauf $p\dots r$ auf $w_1$ und $B \Rightarrow^* w_1$\\
	\phantom{Nach IV }$\exists$ Lauf $r\dots q$ auf $w_2$ und $C \Rightarrow^* w_2$\\
	$\curvearrowright\ \exists$ Lauf $p\dots r\dots q$ auf $w_1 w_2=w$ und $A \Rightarrow BC \Rightarrow^* w$
	
	Nun gilt 
	\begin{align*}
	    w \in L(\mathcal{G}') & \<=> S \=>^* w \\
	    & \<=> \exists q'\in F: (q_0, S, q') \=>^* w \\
	    & \<=> \exists q'\in F: \exists \text{ Lauf von $q_0$ nach $q'$ auf $w$} \land S \=>^* w \\
	    & \<=> w \in R = L(M) \land w \in L = L(\mathcal{G}) \\
	    & \<=> w \in R \cap L
	\end{align*}
\end{proof}
%\rlerror{Vorlesung 18.12.15 unvollständig (Aufschrieb vorhanden)}
%
\vspace{-.5em}
%
%Zuletzt: $\acsu{CFL}\land\acsu{REG}=\ac{REG}$
\begin{Satz}[name={[$L\subseteq R$ entscheidbar]}] %\rlwarning{Satz 4.9}
	Falls $L\in\ac{CFL}$ und $R\in\textrm{REG}$, dann ist "`$L\subseteq R$?"' entscheidbar.
\end{Satz}
\begin{proof}
	$L\subseteq R\curvearrowleftright \underbrace{L \cap\overline{R}}_{\ac{CFL}} = \varnothing$ entscheidbar.
\end{proof}